from ams.pipes.p_smallify_files import process as p_small


def test_fix_naked_ticker():
    # Arrange
    json = "{\"version\": \"0.9.2\", \"f22_ticker\": AACQ, \"tweet\": {\"created_at\": \"Wed Jan 20 02:56:53 +0000 2021\", \"id\": 1351725357133606912, \"id_str\": \"1351725357133606912\", \"text\": \"Started building my newest portfolio (Charlotte) focused on speculative #SPACs (similar to my Memphis Biotech portf\u2026 https://t.co/DjoATRzBx1\", \"truncated\": true, \"entities\": {\"hashtags\": [{\"text\": \"SPACs\", \"indices\": [72, 78]}], \"symbols\": [], \"user_mentions\": [], \"urls\": [{\"url\": \"https://t.co/DjoATRzBx1\", \"expanded_url\": \"https://twitter.com/i/web/status/1351725357133606912\", \"display_url\": \"twitter.com/i/web/status/1\u2026\", \"indices\": [117, 140]}]}, \"metadata\": {\"iso_language_code\": \"en\", \"result_type\": \"recent\"}, \"source\": \"<a href=\"http://twitter.com/download/iphone\" rel=\"nofollow\">Twitter for iPhone</a>\", \"in_reply_to_status_id\": null, \"in_reply_to_status_id_str\": null, \"in_reply_to_user_id\": null, \"in_reply_to_user_id_str\": null, \"in_reply_to_screen_name\": null, \"user\": {\"id\": 3278201701, \"id_str\": \"3278201701\", \"name\": \"Main Street Investor\", \"screen_name\": \"RootedonMain\", \"location\": \"\", \"description\": \"Millionaire Tomorrow.. Billionaire One Day.. Live from Main Street not Wall Street! #Selfmade he/him Bitmoji by Snap \ud83d\udc7b a public diary not investment advice.\", \"url\": null, \"entities\": {\"description\": {\"urls\": []}}, \"protected\": false, \"followers_count\": 1663, \"friends_count\": 215, \"listed_count\": 50, \"created_at\": \"Mon Jul 13 04:51:33 +0000 2015\", \"favourites_count\": 5962, \"utc_offset\": null, \"time_zone\": null, \"geo_enabled\": false, \"verified\": false, \"statuses_count\": 13349, \"lang\": null, \"contributors_enabled\": false, \"is_translator\": false, \"is_translation_enabled\": false, \"profile_background_color\": \"131516\", \"profile_background_image_url\": \"http://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_image_url_https\": \"https://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_tile\": true, \"profile_image_url\": \"http://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_image_url_https\": \"https://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_banner_url\": \"https://pbs.twimg.com/profile_banners/3278201701/1607180065\", \"profile_link_color\": \"ABB8C2\", \"profile_sidebar_border_color\": \"000000\", \"profile_sidebar_fill_color\": \"000000\", \"profile_text_color\": \"000000\", \"profile_use_background_image\": true, \"has_extended_profile\": false, \"default_profile\": false, \"default_profile_image\": false, \"following\": null, \"follow_request_sent\": null, \"notifications\": null, \"translator_type\": \"none\"}, \"geo\": null, \"coordinates\": null, \"place\": null, \"contributors\": null, \"is_quote_status\": false, \"retweet_count\": 0, \"favorite_count\": 4, \"favorited\": false, \"retweeted\": false, \"lang\": \"en\"}}"
    expected_json = "{\"version\": \"0.9.2\", \"f22_ticker\": \"AACQ\", \"tweet\": {\"created_at\": \"Wed Jan 20 02:56:53 +0000 2021\", \"id\": 1351725357133606912, \"id_str\": \"1351725357133606912\", \"text\": \"Started building my newest portfolio (Charlotte) focused on speculative #SPACs (similar to my Memphis Biotech portf\u2026 https://t.co/DjoATRzBx1\", \"truncated\": true, \"entities\": {\"hashtags\": [{\"text\": \"SPACs\", \"indices\": [72, 78]}], \"symbols\": [], \"user_mentions\": [], \"urls\": [{\"url\": \"https://t.co/DjoATRzBx1\", \"expanded_url\": \"https://twitter.com/i/web/status/1351725357133606912\", \"display_url\": \"twitter.com/i/web/status/1\u2026\", \"indices\": [117, 140]}]}, \"metadata\": {\"iso_language_code\": \"en\", \"result_type\": \"recent\"}, \"source\": \"<a href=\"http://twitter.com/download/iphone\" rel=\"nofollow\">Twitter for iPhone</a>\", \"in_reply_to_status_id\": null, \"in_reply_to_status_id_str\": null, \"in_reply_to_user_id\": null, \"in_reply_to_user_id_str\": null, \"in_reply_to_screen_name\": null, \"user\": {\"id\": 3278201701, \"id_str\": \"3278201701\", \"name\": \"Main Street Investor\", \"screen_name\": \"RootedonMain\", \"location\": \"\", \"description\": \"Millionaire Tomorrow.. Billionaire One Day.. Live from Main Street not Wall Street! #Selfmade he/him Bitmoji by Snap \ud83d\udc7b a public diary not investment advice.\", \"url\": null, \"entities\": {\"description\": {\"urls\": []}}, \"protected\": false, \"followers_count\": 1663, \"friends_count\": 215, \"listed_count\": 50, \"created_at\": \"Mon Jul 13 04:51:33 +0000 2015\", \"favourites_count\": 5962, \"utc_offset\": null, \"time_zone\": null, \"geo_enabled\": false, \"verified\": false, \"statuses_count\": 13349, \"lang\": null, \"contributors_enabled\": false, \"is_translator\": false, \"is_translation_enabled\": false, \"profile_background_color\": \"131516\", \"profile_background_image_url\": \"http://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_image_url_https\": \"https://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_tile\": true, \"profile_image_url\": \"http://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_image_url_https\": \"https://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_banner_url\": \"https://pbs.twimg.com/profile_banners/3278201701/1607180065\", \"profile_link_color\": \"ABB8C2\", \"profile_sidebar_border_color\": \"000000\", \"profile_sidebar_fill_color\": \"000000\", \"profile_text_color\": \"000000\", \"profile_use_background_image\": true, \"has_extended_profile\": false, \"default_profile\": false, \"default_profile_image\": false, \"following\": null, \"follow_request_sent\": null, \"notifications\": null, \"translator_type\": \"none\"}, \"geo\": null, \"coordinates\": null, \"place\": null, \"contributors\": null, \"is_quote_status\": false, \"retweet_count\": 0, \"favorite_count\": 4, \"favorited\": false, \"retweeted\": false, \"lang\": \"en\"}}"
    # Act
    fixed_json = p_small.fix_naked_ticker(json)

    # Assert
    assert (fixed_json == expected_json)

def test_fix_non_naked_ticker():
    # Arrange
    json = "{\"version\": \"0.9.2\", \"f22_ticker\": \"AACQ\", \"tweet\": {\"created_at\": \"Wed Jan 20 02:56:53 +0000 2021\", \"id\": 1351725357133606912, \"id_str\": \"1351725357133606912\", \"text\": \"Started building my newest portfolio (Charlotte) focused on speculative #SPACs (similar to my Memphis Biotech portf\u2026 https://t.co/DjoATRzBx1\", \"truncated\": true, \"entities\": {\"hashtags\": [{\"text\": \"SPACs\", \"indices\": [72, 78]}], \"symbols\": [], \"user_mentions\": [], \"urls\": [{\"url\": \"https://t.co/DjoATRzBx1\", \"expanded_url\": \"https://twitter.com/i/web/status/1351725357133606912\", \"display_url\": \"twitter.com/i/web/status/1\u2026\", \"indices\": [117, 140]}]}, \"metadata\": {\"iso_language_code\": \"en\", \"result_type\": \"recent\"}, \"source\": \"<a href=\"http://twitter.com/download/iphone\" rel=\"nofollow\">Twitter for iPhone</a>\", \"in_reply_to_status_id\": null, \"in_reply_to_status_id_str\": null, \"in_reply_to_user_id\": null, \"in_reply_to_user_id_str\": null, \"in_reply_to_screen_name\": null, \"user\": {\"id\": 3278201701, \"id_str\": \"3278201701\", \"name\": \"Main Street Investor\", \"screen_name\": \"RootedonMain\", \"location\": \"\", \"description\": \"Millionaire Tomorrow.. Billionaire One Day.. Live from Main Street not Wall Street! #Selfmade he/him Bitmoji by Snap \ud83d\udc7b a public diary not investment advice.\", \"url\": null, \"entities\": {\"description\": {\"urls\": []}}, \"protected\": false, \"followers_count\": 1663, \"friends_count\": 215, \"listed_count\": 50, \"created_at\": \"Mon Jul 13 04:51:33 +0000 2015\", \"favourites_count\": 5962, \"utc_offset\": null, \"time_zone\": null, \"geo_enabled\": false, \"verified\": false, \"statuses_count\": 13349, \"lang\": null, \"contributors_enabled\": false, \"is_translator\": false, \"is_translation_enabled\": false, \"profile_background_color\": \"131516\", \"profile_background_image_url\": \"http://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_image_url_https\": \"https://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_tile\": true, \"profile_image_url\": \"http://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_image_url_https\": \"https://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_banner_url\": \"https://pbs.twimg.com/profile_banners/3278201701/1607180065\", \"profile_link_color\": \"ABB8C2\", \"profile_sidebar_border_color\": \"000000\", \"profile_sidebar_fill_color\": \"000000\", \"profile_text_color\": \"000000\", \"profile_use_background_image\": true, \"has_extended_profile\": false, \"default_profile\": false, \"default_profile_image\": false, \"following\": null, \"follow_request_sent\": null, \"notifications\": null, \"translator_type\": \"none\"}, \"geo\": null, \"coordinates\": null, \"place\": null, \"contributors\": null, \"is_quote_status\": false, \"retweet_count\": 0, \"favorite_count\": 4, \"favorited\": false, \"retweeted\": false, \"lang\": \"en\"}}"
    expected_json = "{\"version\": \"0.9.2\", \"f22_ticker\": \"AACQ\", \"tweet\": {\"created_at\": \"Wed Jan 20 02:56:53 +0000 2021\", \"id\": 1351725357133606912, \"id_str\": \"1351725357133606912\", \"text\": \"Started building my newest portfolio (Charlotte) focused on speculative #SPACs (similar to my Memphis Biotech portf\u2026 https://t.co/DjoATRzBx1\", \"truncated\": true, \"entities\": {\"hashtags\": [{\"text\": \"SPACs\", \"indices\": [72, 78]}], \"symbols\": [], \"user_mentions\": [], \"urls\": [{\"url\": \"https://t.co/DjoATRzBx1\", \"expanded_url\": \"https://twitter.com/i/web/status/1351725357133606912\", \"display_url\": \"twitter.com/i/web/status/1\u2026\", \"indices\": [117, 140]}]}, \"metadata\": {\"iso_language_code\": \"en\", \"result_type\": \"recent\"}, \"source\": \"<a href=\"http://twitter.com/download/iphone\" rel=\"nofollow\">Twitter for iPhone</a>\", \"in_reply_to_status_id\": null, \"in_reply_to_status_id_str\": null, \"in_reply_to_user_id\": null, \"in_reply_to_user_id_str\": null, \"in_reply_to_screen_name\": null, \"user\": {\"id\": 3278201701, \"id_str\": \"3278201701\", \"name\": \"Main Street Investor\", \"screen_name\": \"RootedonMain\", \"location\": \"\", \"description\": \"Millionaire Tomorrow.. Billionaire One Day.. Live from Main Street not Wall Street! #Selfmade he/him Bitmoji by Snap \ud83d\udc7b a public diary not investment advice.\", \"url\": null, \"entities\": {\"description\": {\"urls\": []}}, \"protected\": false, \"followers_count\": 1663, \"friends_count\": 215, \"listed_count\": 50, \"created_at\": \"Mon Jul 13 04:51:33 +0000 2015\", \"favourites_count\": 5962, \"utc_offset\": null, \"time_zone\": null, \"geo_enabled\": false, \"verified\": false, \"statuses_count\": 13349, \"lang\": null, \"contributors_enabled\": false, \"is_translator\": false, \"is_translation_enabled\": false, \"profile_background_color\": \"131516\", \"profile_background_image_url\": \"http://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_image_url_https\": \"https://abs.twimg.com/images/themes/theme14/bg.gif\", \"profile_background_tile\": true, \"profile_image_url\": \"http://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_image_url_https\": \"https://pbs.twimg.com/profile_images/1352606951377657856/rqrenibY_normal.jpg\", \"profile_banner_url\": \"https://pbs.twimg.com/profile_banners/3278201701/1607180065\", \"profile_link_color\": \"ABB8C2\", \"profile_sidebar_border_color\": \"000000\", \"profile_sidebar_fill_color\": \"000000\", \"profile_text_color\": \"000000\", \"profile_use_background_image\": true, \"has_extended_profile\": false, \"default_profile\": false, \"default_profile_image\": false, \"following\": null, \"follow_request_sent\": null, \"notifications\": null, \"translator_type\": \"none\"}, \"geo\": null, \"coordinates\": null, \"place\": null, \"contributors\": null, \"is_quote_status\": false, \"retweet_count\": 0, \"favorite_count\": 4, \"favorited\": false, \"retweeted\": false, \"lang\": \"en\"}}"
    # Act
    fixed_json = p_small.fix_naked_ticker(json)

    # Assert
    assert (fixed_json == expected_json)